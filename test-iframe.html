<!DOCTYPE html>
<html>
<head>
    <title>Test Average Trade Format</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        iframe { width: 100%; height: 800px; border: 1px solid #ccc; }
        .results { margin-top: 20px; padding: 10px; background: #f5f5f5; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Average Trade Format Test</h1>
    <iframe id="app-iframe" src="https://trading-strategy-n7aifyac8-tonys-projects-297706df.vercel.app/"></iframe>
    
    <div class="results" id="results">
        <p>Loading app and testing...</p>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const p = document.createElement('p');
            p.className = type;
            p.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            results.appendChild(p);
        }

        function testAverageTradeFormat() {
            const iframe = document.getElementById('app-iframe');
            
            iframe.onload = function() {
                log('App loaded, waiting for content...');
                
                setTimeout(() => {
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        const bodyText = iframeDoc.body.textContent || iframeDoc.body.innerText || '';
                        
                        log('Page text length: ' + bodyText.length);
                        
                        // Check for Average Trade
                        const hasAverageTrade = bodyText.includes('Average Trade');
                        log('Contains "Average Trade": ' + hasAverageTrade, hasAverageTrade ? 'success' : 'error');
                        
                        // Find currency values
                        const currencyRegex = /\$[\d,]+\.?\d*[MK]?/g;
                        const currencyMatches = bodyText.match(currencyRegex) || [];
                        log('Found currency values: ' + currencyMatches.slice(0, 10).join(', '));
                        
                        // Check for M vs K
                        const mValues = currencyMatches.filter(val => val.endsWith('M'));
                        const kValues = currencyMatches.filter(val => val.endsWith('K'));
                        
                        log('Values ending with M: ' + mValues.join(', '), mValues.length > 0 ? 'error' : 'success');
                        log('Values ending with K: ' + kValues.join(', '), kValues.length > 0 ? 'success' : 'info');
                        
                        // Look for specific elements
                        const averageTradeElements = iframeDoc.querySelectorAll('*');
                        let foundTradeValues = [];
                        
                        for (let el of averageTradeElements) {
                            const text = el.textContent || '';
                            if (text.includes('Average Trade') || text.includes('Avg Winner') || text.includes('Avg Loser')) {
                                foundTradeValues.push(text.trim());
                            }
                        }
                        
                        log('Trade-related elements found: ' + foundTradeValues.length);
                        foundTradeValues.forEach(val => log('  - ' + val));
                        
                    } catch (error) {
                        log('Error accessing iframe content: ' + error.message, 'error');
                        log('This might be due to CORS restrictions', 'error');
                    }
                }, 10000); // Wait 10 seconds for React to load
            };
        }

        // Start the test
        testAverageTradeFormat();
    </script>
</body>
</html>